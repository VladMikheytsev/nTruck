<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç GPS API –Ω–∞–ø—Ä—è–º—É—é</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; }
        .button { padding: 15px 30px; margin: 10px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .status { padding: 15px; margin: 20px 0; border-radius: 4px; }
        .status.info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        .status.success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .status.error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .log { background: #f8f9fa; border: 1px solid #dee2e6; padding: 15px; margin: 10px 0; border-radius: 4px; font-family: monospace; white-space: pre-wrap; max-height: 300px; overflow-y: auto; }
        .input-group { margin: 10px 0; }
        .input-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .input-group input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß –¢–µ—Å—Ç GPS API –Ω–∞–ø—Ä—è–º—É—é</h1>
        
        <div class="status info">
            <strong>‚ÑπÔ∏è –ü—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 3003</strong><br>
            –¢–µ—Å—Ç–∏—Ä—É–µ–º GPS API —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
        </div>

        <h3>üì° –¢–µ—Å—Ç GPS API:</h3>
        
        <div class="input-group">
            <label for="apiKey">API Key:</label>
            <input type="text" id="apiKey" value="Xx7MWwsU..." placeholder="–í–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á">
        </div>
        
        <div class="input-group">
            <label for="deviceId">Device ID:</label>
            <input type="number" id="deviceId" value="153332" placeholder="–í–≤–µ–¥–∏—Ç–µ Device ID">
        </div>

        <button class="button btn-primary" onclick="testGPSAPI()">
            üì° –¢–µ—Å—Ç GPS API
        </button>
        
        <button class="button btn-success" onclick="testWithRealData()">
            üéØ –¢–µ—Å—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
        </button>
        
        <button class="button btn-warning" onclick="clearLogs()">
            üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏
        </button>

        <h3>üìã –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</h3>
        <div id="logs" class="log">–ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é...\n</div>

        <h3>üéØ –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:</h3>
        <div class="status success">
            ‚úÖ <strong>–£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç:</strong><br>
            ‚Ä¢ –°—Ç–∞—Ç—É—Å: 200 OK<br>
            ‚Ä¢ –î–∞–Ω–Ω—ã–µ: {"position": {"lat": 34.23834, "lng": -118.414}}<br>
            ‚Ä¢ –í—Ä–µ–º—è: –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –≤—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ç–∫–∞
        </div>

        <div class="status error">
            ‚ùå <strong>–í–æ–∑–º–æ–∂–Ω—ã–µ –æ—à–∏–±–∫–∏:</strong><br>
            ‚Ä¢ 400 Bad Request - –Ω–µ–≤–µ—Ä–Ω—ã–π API –∫–ª—é—á –∏–ª–∏ Device ID<br>
            ‚Ä¢ 429 Too Many Requests - –ø—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤<br>
            ‚Ä¢ 500 Internal Server Error - –æ—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
        </div>
    </div>

    <script>
        let logs = [];

        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            logs.push(logEntry);
            
            const logsElement = document.getElementById('logs');
            logsElement.textContent = logs.join('\n');
            logsElement.scrollTop = logsElement.scrollHeight;
            
            console.log(logEntry);
        }

        function clearLogs() {
            logs = [];
            document.getElementById('logs').textContent = '–õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã...\n';
        }

        async function testGPSAPI() {
            const apiKey = document.getElementById('apiKey').value;
            const deviceId = parseInt(document.getElementById('deviceId').value);
            
            if (!apiKey || !deviceId) {
                addLog('‚ùå –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!', 'error');
                return;
            }

            addLog('üì° –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ GPS API...');
            addLog(`üì§ API Key: ${apiKey}`);
            addLog(`üì§ Device ID: ${deviceId}`);
            
            try {
                const testData = {
                    APIKey: apiKey,
                    DeviceID: deviceId
                };
                
                addLog(`üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä—É...`);
                
                const response = await fetch('http://localhost:3003/api/trak4/device', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    addLog('‚úÖ GPS API —Ä–∞–±–æ—Ç–∞–µ—Ç!', 'success');
                    addLog(`üìä –°—Ç–∞—Ç—É—Å: ${response.status} ${response.statusText}`, 'success');
                    addLog(`üìä –î–∞–Ω–Ω—ã–µ: ${JSON.stringify(data, null, 2)}`, 'success');
                    
                    if (data.position) {
                        addLog(`üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ${data.position.lat}, ${data.position.lng}`, 'success');
                    }
                } else {
                    addLog(`‚ùå GPS API –æ—à–∏–±–∫–∞: ${data.error || 'Unknown error'}`, 'error');
                    addLog(`üìä –°—Ç–∞—Ç—É—Å: ${response.status} ${response.statusText}`, 'error');
                    addLog(`üìä –î–µ—Ç–∞–ª–∏: ${JSON.stringify(data, null, 2)}`, 'error');
                }
            } catch (error) {
                addLog(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`, 'error');
                addLog(`üí° –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω: node proxy-server.cjs`, 'error');
            }
        }

        async function testWithRealData() {
            addLog('üéØ –¢–µ—Å—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ –∫–∞—Ä—Ç–æ—á–µ–∫ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞...');
            
            // –î–∞–Ω–Ω—ã–µ –∏–∑ vehicle-001
            document.getElementById('apiKey').value = 'Xx7MWwsU...';
            document.getElementById('deviceId').value = '153332';
            
            addLog('üìã –ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ vehicle-001:');
            addLog('   API Key: Xx7MWwsU...');
            addLog('   Device ID: 153332');
            
            await testGPSAPI();
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            addLog('üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è GPS API...');
            addLog('üí° –ù–∞–∂–º–∏—Ç–µ "üéØ –¢–µ—Å—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏" –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ç–µ—Å—Ç–∞');
        };
    </script>
</body>
</html>
