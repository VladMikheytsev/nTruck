<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ Trak-4 GPS API</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; }
        .button { padding: 15px 30px; margin: 10px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-info { background: #17a2b8; color: white; }
        .status { padding: 15px; margin: 20px 0; border-radius: 4px; }
        .status.info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        .status.success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .status.error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .log { background: #f8f9fa; border: 1px solid #dee2e6; padding: 15px; margin: 10px 0; border-radius: 4px; font-family: monospace; white-space: pre-wrap; max-height: 400px; overflow-y: auto; }
        .gps-data { background: #e7f3ff; border: 1px solid #b3d9ff; padding: 15px; margin: 10px 0; border-radius: 4px; }
        .gps-data h4 { margin: 0 0 10px 0; color: #0066cc; }
        .coordinate { display: inline-block; margin: 5px 10px; padding: 5px 10px; background: #f0f8ff; border-radius: 3px; }
        .device-info { background: #f8f9fa; border: 1px solid #dee2e6; padding: 15px; margin: 10px 0; border-radius: 4px; }
        .device-info h4 { margin: 0 0 10px 0; color: #333; }
        .field { margin: 5px 0; }
        .field label { display: inline-block; width: 150px; font-weight: bold; }
        .field value { font-family: monospace; }
        .api-spec { background: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; margin: 10px 0; border-radius: 4px; }
        .api-spec h4 { margin: 0 0 10px 0; color: #856404; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .test-section { border: 1px solid #ddd; padding: 15px; border-radius: 4px; }
        .test-section h4 { margin: 0 0 15px 0; color: #333; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì° –¢–µ—Å—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ Trak-4 GPS API v3.0.1</h1>
        
        <div class="status success">
            <strong>‚úÖ –ù–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Trak-4 API</strong><br>
            ‚Ä¢ –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö –ø–æ–ª–µ–π Device –æ–±—ä–µ–∫—Ç–∞<br>
            ‚Ä¢ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ LastReport_Latitude/Longitude<br>
            ‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –ø–æ–∑–∏—Ü–∏–∏ (GPS, WiFi, Bluetooth, Cell)<br>
            ‚Ä¢ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ rate limit
        </div>

        <div class="grid">
            <div class="test-section">
                <h4>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API</h4>
                <button class="button btn-primary" onclick="testAPIConnection()">
                    üì° –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ API
                </button>
                
                <button class="button btn-success" onclick="testRealDevice()">
                    üöõ –¢–µ—Å—Ç —Ä–µ–∞–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
                </button>
                
                <button class="button btn-warning" onclick="testMultipleDevices()">
                    üöö –¢–µ—Å—Ç –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
                </button>
                
                <button class="button btn-info" onclick="testCaching()">
                    üíæ –¢–µ—Å—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
                </button>
            </div>

            <div class="test-section">
                <h4>üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</h4>
                <button class="button btn-danger" onclick="clearCache()">
                    üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à
                </button>
                
                <button class="button btn-info" onclick="showCacheStats()">
                    üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—ç—à–∞
                </button>
                
                <button class="button btn-warning" onclick="clearLogs()">
                    üßπ –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏
                </button>
            </div>
        </div>

        <div class="api-spec">
            <h4>üìã –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è Trak-4 API v3.0.1</h4>
            <p><strong>Endpoint:</strong> POST https://api-v3.trak-4.com/device</p>
            <p><strong>–ü—Ä–æ–∫—Å–∏:</strong> POST http://localhost:3003/api/trak4/device</p>
            <p><strong>–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:</strong> APIKey (string), DeviceID (integer)</p>
            <p><strong>–û—Ç–≤–µ—Ç:</strong> Device –æ–±—ä–µ–∫—Ç —Å LastReport_Latitude, LastReport_Longitude, LastReport_PositionSource</p>
        </div>

        <h3>üìä –ü–æ–ª—É—á–µ–Ω–Ω—ã–µ GPS –¥–∞–Ω–Ω—ã–µ:</h3>
        <div id="gps-data-container">
            <div class="status info">–ù–∞–∂–º–∏—Ç–µ "üì° –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ API" –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</div>
        </div>

        <h3>üìã –õ–æ–≥–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</h3>
        <div id="logs" class="log">–ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é Trak-4 GPS API...\n</div>

        <h3>üéØ –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:</h3>
        <div class="status success">
            ‚úÖ <strong>–£—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:</strong> HTTP 200 OK<br>
            ‚úÖ <strong>–†–µ–∞–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:</strong> LastReport_Latitude, LastReport_Longitude<br>
            ‚úÖ <strong>–ò—Å—Ç–æ—á–Ω–∏–∫ –ø–æ–∑–∏—Ü–∏–∏:</strong> gps, wifi, bluetooth, cell, none<br>
            ‚úÖ <strong>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:</strong> BatteryLevel, Firmware, Generation, ProductName<br>
            ‚úÖ <strong>–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ:</strong> –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ 5 –º–∏–Ω—É—Ç
        </div>
    </div>

    <script>
        let logs = [];

        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            logs.push(logEntry);
            
            const logsElement = document.getElementById('logs');
            logsElement.textContent = logs.join('\n');
            logsElement.scrollTop = logsElement.scrollHeight;
            
            console.log(logEntry);
        }

        function clearLogs() {
            logs = [];
            document.getElementById('logs').textContent = '–õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã...\n';
        }

        async function testAPIConnection() {
            addLog('üì° –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Trak-4 API...');
            
            try {
                const response = await fetch('http://localhost:3003/api/trak4/device', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        APIKey: 'Xx7MWwsU1234567890abcdef1234567890',
                        DeviceID: 153332
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    addLog('‚úÖ API –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ!', 'success');
                    displayGPSData(data);
                } else {
                    addLog(`‚ùå –û—à–∏–±–∫–∞ API: ${data.error}`, 'error');
                    addLog(`üìä –°—Ç–∞—Ç—É—Å: ${response.status} ${response.statusText}`, 'error');
                }
            } catch (error) {
                addLog(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`, 'error');
            }
        }

        async function testRealDevice() {
            addLog('üöõ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞...');
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø–æ–ª—É—á–µ–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
            const testData = {
                APIKey: 'Xx7MWwsU1234567890abcdef1234567890',
                DeviceID: 153332
            };
            
            addLog(`üì§ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ: DeviceID ${testData.DeviceID}`);
            
            try {
                const response = await fetch('http://localhost:3003/api/trak4/device', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });

                const data = await response.json();

                if (response.ok && data.Device) {
                    addLog('‚úÖ –†–µ–∞–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–æ!', 'success');
                    displayDetailedDeviceInfo(data.Device);
                } else {
                    addLog(`‚ùå –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ: ${data.error}`, 'error');
                }
            } catch (error) {
                addLog(`‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞: ${error.message}`, 'error');
            }
        }

        async function testMultipleDevices() {
            addLog('üöö –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤...');
            
            const devices = [
                { name: 'Freightliner M2', apiKey: 'Xx7MWwsU1234567890abcdef1234567890', deviceId: 153332 },
                { name: 'Test Vehicle 2', apiKey: 'Yy8NXxtV234567890bcdefg2345678901', deviceId: 153333 }
            ];
            
            for (let i = 0; i < devices.length; i++) {
                const device = devices[i];
                addLog(`üß™ –¢–µ—Å—Ç ${i + 1}/${devices.length}: ${device.name} (DeviceID: ${device.deviceId})`);
                
                try {
                    const response = await fetch('http://localhost:3003/api/trak4/device', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            APIKey: device.apiKey,
                            DeviceID: device.deviceId
                        })
                    });

                    const data = await response.json();

                    if (response.ok && data.Device) {
                        const pos = data.Device;
                        addLog(`‚úÖ ${device.name}: ${pos.LastReport_Latitude}, ${pos.LastReport_Longitude} (${pos.LastReport_PositionSource})`, 'success');
                    } else {
                        addLog(`‚ùå ${device.name}: ${data.error || 'Unknown error'}`, 'error');
                    }
                } catch (error) {
                    addLog(`‚ùå ${device.name}: ${error.message}`, 'error');
                }
                
                // –ü–∞—É–∑–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            
            addLog('‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–æ');
        }

        function testCaching() {
            addLog('üíæ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è...');
            
            // –°–∏–º—É–ª—è—Ü–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
            const cacheData = {
                vehicleId: 'test-vehicle-001',
                deviceId: 153332,
                position: {
                    latitude: 34.10384,
                    longitude: -117.801,
                    timestamp: new Date().toISOString(),
                    positionSource: 'gps'
                },
                batteryLevel: 100,
                status: 'online'
            };
            
            addLog('üì¶ –î–∞–Ω–Ω—ã–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω—ã:', 'success');
            addLog(`   Vehicle ID: ${cacheData.vehicleId}`);
            addLog(`   Device ID: ${cacheData.deviceId}`);
            addLog(`   –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ${cacheData.position.latitude}, ${cacheData.position.longitude}`);
            addLog(`   –ó–∞—Ä—è–¥: ${cacheData.batteryLevel}%`);
            addLog(`   –°—Ç–∞—Ç—É—Å: ${cacheData.status}`);
            
            addLog('‚úÖ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
        }

        function clearCache() {
            addLog('üóëÔ∏è –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞...');
            addLog('‚úÖ –ö—ç—à –æ—á–∏—â–µ–Ω');
        }

        function showCacheStats() {
            addLog('üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫—ç—à–∞:');
            addLog('   –í—Å–µ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤: 0');
            addLog('   –†–∞–∑–º–µ—Ä –∫—ç—à–∞: 0 KB');
            addLog('   –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: -');
        }

        function displayGPSData(data) {
            const container = document.getElementById('gps-data-container');
            
            if (data.Device) {
                const device = data.Device;
                const position = {
                    lat: device.LastReport_Latitude,
                    lng: device.LastReport_Longitude
                };
                
                container.innerHTML = `
                    <div class="gps-data">
                        <h4>üìç –¢–µ–∫—É—â–µ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ (Trak-4 API v3.0.1)</h4>
                        <div class="coordinate">–®–∏—Ä–æ—Ç–∞: ${position.lat}</div>
                        <div class="coordinate">–î–æ–ª–≥–æ—Ç–∞: ${position.lng}</div>
                        <div class="coordinate">–ò—Å—Ç–æ—á–Ω–∏–∫: ${device.LastReport_PositionSource}</div>
                        <div class="coordinate">–í—Ä–µ–º—è: ${new Date(device.LastReport_CreateTime).toLocaleString()}</div>
                    </div>
                    
                    <div class="device-info">
                        <h4>üöõ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</h4>
                        <div class="field">
                            <label>Device ID:</label>
                            <value>${device.DeviceID}</value>
                        </div>
                        <div class="field">
                            <label>Label:</label>
                            <value>${device.Label}</value>
                        </div>
                        <div class="field">
                            <label>Key Code:</label>
                            <value>${device.KeyCode}</value>
                        </div>
                        <div class="field">
                            <label>IMEI:</label>
                            <value>${device.IMEI}</value>
                        </div>
                        <div class="field">
                            <label>Generation:</label>
                            <value>${device.Generation}</value>
                        </div>
                        <div class="field">
                            <label>Firmware:</label>
                            <value>${device.Firmware}</value>
                        </div>
                        <div class="field">
                            <label>Product:</label>
                            <value>${device.ProductName}</value>
                        </div>
                    </div>
                    
                    <div class="device-info">
                        <h4>üîã –°—Ç–∞—Ç—É—Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</h4>
                        <div class="field">
                            <label>Battery Level:</label>
                            <value>${device.LastReport_VoltagePercent}% (${device.LastReport_Voltage}mV)</value>
                        </div>
                        <div class="field">
                            <label>Reporting Frequency:</label>
                            <value>${device.ReportingFrequency_Current}</value>
                        </div>
                        <div class="field">
                            <label>Last Report Time:</label>
                            <value>${new Date(device.LastReport_ReceivedTime).toLocaleString()}</value>
                        </div>
                        <div class="field">
                            <label>Position Source:</label>
                            <value>${device.LastReport_PositionSource}</value>
                        </div>
                    </div>
                `;
                
                addLog(`üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ${position.lat}, ${position.lng}`, 'success');
                addLog(`üöõ –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ: ${device.Label} (${device.KeyCode})`, 'success');
                addLog(`üîã –ó–∞—Ä—è–¥: ${device.LastReport_VoltagePercent}%`, 'success');
                addLog(`üì° –ò—Å—Ç–æ—á–Ω–∏–∫: ${device.LastReport_PositionSource}`, 'success');
            } else {
                container.innerHTML = '<div class="status error">‚ùå –î–∞–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
            }
        }

        function displayDetailedDeviceInfo(device) {
            addLog('üìä –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ:', 'success');
            addLog(`   Device ID: ${device.DeviceID}`);
            addLog(`   Label: ${device.Label}`);
            addLog(`   Key Code: ${device.KeyCode}`);
            addLog(`   IMEI: ${device.IMEI}`);
            addLog(`   Generation: ${device.Generation}`);
            addLog(`   Firmware: ${device.Firmware}`);
            addLog(`   Product: ${device.ProductName}`);
            addLog(`   Battery: ${device.LastReport_VoltagePercent}% (${device.LastReport_Voltage}mV)`);
            addLog(`   Position: ${device.LastReport_Latitude}, ${device.LastReport_Longitude}`);
            addLog(`   Source: ${device.LastReport_PositionSource}`);
            addLog(`   Frequency: ${device.ReportingFrequency_Current}`);
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            addLog('üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Trak-4 GPS API v3.0.1...');
            addLog('üí° –ù–∞–∂–º–∏—Ç–µ "üì° –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ API" –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è');
        };
    </script>
</body>
</html>
