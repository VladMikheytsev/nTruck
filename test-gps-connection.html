<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç GPS –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; }
        .button { padding: 15px 30px; margin: 10px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .btn-danger { background: #dc3545; color: white; }
        .status { padding: 15px; margin: 20px 0; border-radius: 4px; }
        .status.info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        .status.success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .status.error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .log { background: #f8f9fa; border: 1px solid #dee2e6; padding: 15px; margin: 10px 0; border-radius: 4px; font-family: monospace; white-space: pre-wrap; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß –¢–µ—Å—Ç GPS –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h1>
        
        <div class="status info">
            <strong>‚ÑπÔ∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤:</strong><br>
            ‚Ä¢ –ü—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä GPS: <span id="proxy-status">–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è...</span><br>
            ‚Ä¢ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ: <span id="app-status">–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è...</span><br>
            ‚Ä¢ GPS API: <span id="gps-status">–ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è...</span>
        </div>

        <h3>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ GPS –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:</h3>
        <button class="button btn-primary" onclick="testProxyServer()">
            üîó –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä
        </button>
        
        <button class="button btn-success" onclick="testGPSAPI()">
            üì° –¢–µ—Å—Ç GPS API (vehicle-001)
        </button>
        
        <button class="button btn-warning" onclick="testAppConnection()">
            üåê –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        </button>

        <button class="button btn-danger" onclick="clearLogs()">
            üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏
        </button>

        <h3>üìã –õ–æ–≥–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</h3>
        <div id="logs" class="log">–ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é...\n</div>

        <h3>üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:</h3>
        <ol>
            <li>‚úÖ –ü—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω –Ω–∞ –ø–æ—Ä—Ç—É 3003</li>
            <li>‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ –Ω–∞ –ø–æ—Ä—Ç—É 3001</li>
            <li>‚úÖ GPS API –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—á–∞—Ç—å —á–µ—Ä–µ–∑ –ø—Ä–æ–∫—Å–∏</li>
            <li>‚úÖ –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –Ω–∞ –∫–∞—Ä—Ç–µ</li>
        </ol>

        <div class="status info">
            <strong>üîß –ï—Å–ª–∏ —Ç–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç:</strong><br>
            1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω: <code>node proxy-server.js</code><br>
            2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ GPS –¥–∞–Ω–Ω—ã–µ –≤ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞<br>
            3. –û—á–∏—Å—Ç–∏—Ç–µ –∫—ç—à –±—Ä–∞—É–∑–µ—Ä–∞ –∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É
        </div>
    </div>

    <script>
        let logs = [];

        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            logs.push(logEntry);
            
            const logsElement = document.getElementById('logs');
            logsElement.textContent = logs.join('\n');
            logsElement.scrollTop = logsElement.scrollHeight;
            
            console.log(logEntry);
        }

        function clearLogs() {
            logs = [];
            document.getElementById('logs').textContent = '–õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã...\n';
        }

        async function testProxyServer() {
            addLog('üîó –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä–∞...');
            
            try {
                const response = await fetch('http://localhost:3003/health');
                const data = await response.json();
                
                if (response.ok) {
                    addLog('‚úÖ –ü—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç!', 'success');
                    addLog(`üìä –°—Ç–∞—Ç—É—Å: ${data.status}`, 'success');
                    addLog(`‚è∞ –í—Ä–µ–º—è: ${data.timestamp}`, 'success');
                    document.getElementById('proxy-status').innerHTML = '<span style="color: green;">‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç</span>';
                } else {
                    addLog('‚ùå –ü—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç', 'error');
                    document.getElementById('proxy-status').innerHTML = '<span style="color: red;">‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç</span>';
                }
            } catch (error) {
                addLog(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ø—Ä–æ–∫—Å–∏: ${error.message}`, 'error');
                document.getElementById('proxy-status').innerHTML = '<span style="color: red;">‚ùå –û—à–∏–±–∫–∞</span>';
            }
        }

        async function testGPSAPI() {
            addLog('üì° –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ GPS API...');
            
            try {
                const testData = {
                    APIKey: 'Xx7MWwsU...', // –¢–µ—Å—Ç–æ–≤—ã–π –∫–ª—é—á
                    DeviceID: 153332
                };
                
                addLog(`üì§ –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞: ${JSON.stringify(testData)}`);
                
                const response = await fetch('http://localhost:3003/api/trak4/device', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(testData)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    addLog('‚úÖ GPS API —Ä–∞–±–æ—Ç–∞–µ—Ç!', 'success');
                    addLog(`üìä –î–∞–Ω–Ω—ã–µ: ${JSON.stringify(data, null, 2)}`, 'success');
                    document.getElementById('gps-status').innerHTML = '<span style="color: green;">‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç</span>';
                } else {
                    addLog(`‚ùå GPS API –æ—à–∏–±–∫–∞: ${data.error}`, 'error');
                    addLog(`üìä –°—Ç–∞—Ç—É—Å: ${data.status} ${data.statusText}`, 'error');
                    document.getElementById('gps-status').innerHTML = '<span style="color: red;">‚ùå –û—à–∏–±–∫–∞</span>';
                }
            } catch (error) {
                addLog(`‚ùå –û—à–∏–±–∫–∞ GPS API: ${error.message}`, 'error');
                document.getElementById('gps-status').innerHTML = '<span style="color: red;">‚ùå –û—à–∏–±–∫–∞</span>';
            }
        }

        async function testAppConnection() {
            addLog('üåê –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...');
            
            try {
                const response = await fetch('http://localhost:3001/');
                
                if (response.ok) {
                    addLog('‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ!', 'success');
                    document.getElementById('app-status').innerHTML = '<span style="color: green;">‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç</span>';
                } else {
                    addLog('‚ùå –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç', 'error');
                    document.getElementById('app-status').innerHTML = '<span style="color: red;">‚ùå –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç</span>';
                }
            } catch (error) {
                addLog(`‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: ${error.message}`, 'error');
                document.getElementById('app-status').innerHTML = '<span style="color: red;">‚ùå –û—à–∏–±–∫–∞</span>';
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            addLog('üöÄ –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏...');
            testProxyServer();
            setTimeout(testAppConnection, 1000);
            setTimeout(testGPSAPI, 2000);
        };
    </script>
</body>
</html>
