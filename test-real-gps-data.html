<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ GPS –¥–∞–Ω–Ω—ã–º–∏</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; }
        .button { padding: 15px 30px; margin: 10px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .btn-danger { background: #dc3545; color: white; }
        .status { padding: 15px; margin: 20px 0; border-radius: 4px; }
        .status.info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        .status.success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .status.error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .log { background: #f8f9fa; border: 1px solid #dee2e6; padding: 15px; margin: 10px 0; border-radius: 4px; font-family: monospace; white-space: pre-wrap; max-height: 400px; overflow-y: auto; }
        .gps-data { background: #e7f3ff; border: 1px solid #b3d9ff; padding: 15px; margin: 10px 0; border-radius: 4px; }
        .gps-data h4 { margin: 0 0 10px 0; color: #0066cc; }
        .coordinate { display: inline-block; margin: 5px 10px; padding: 5px 10px; background: #f0f8ff; border-radius: 3px; }
        .device-info { background: #f8f9fa; border: 1px solid #dee2e6; padding: 15px; margin: 10px 0; border-radius: 4px; }
        .device-info h4 { margin: 0 0 10px 0; color: #333; }
        .field { margin: 5px 0; }
        .field label { display: inline-block; width: 150px; font-weight: bold; }
        .field value { font-family: monospace; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üì° –¢–µ—Å—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ GPS –¥–∞–Ω–Ω—ã–º–∏ Trak-4</h1>
        
        <div class="status success">
            <strong>‚úÖ –†–µ–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã!</strong><br>
            API Trak-4 —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
        </div>

        <h3>üöó –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ GPS API:</h3>
        <button class="button btn-primary" onclick="testRealGPSData()">
            üì° –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ GPS –¥–∞–Ω–Ω—ã–µ
        </button>
        
        <button class="button btn-success" onclick="testMultipleDevices()">
            üöõ –¢–µ—Å—Ç –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        </button>
        
        <button class="button btn-warning" onclick="simulateVehicleMovement()">
            üéØ –°–∏–º—É–ª—è—Ü–∏—è –¥–≤–∏–∂–µ–Ω–∏—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
        </button>
        
        <button class="button btn-danger" onclick="clearLogs()">
            üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏
        </button>

        <h3>üìä –ü–æ–ª—É—á–µ–Ω–Ω—ã–µ GPS –¥–∞–Ω–Ω—ã–µ:</h3>
        <div id="gps-data-container">
            <div class="status info">–ù–∞–∂–º–∏—Ç–µ "üì° –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ GPS –¥–∞–Ω–Ω—ã–µ" –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</div>
        </div>

        <h3>üìã –õ–æ–≥–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:</h3>
        <div id="logs" class="log">–ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ GPS –¥–∞–Ω–Ω—ã–º–∏...\n</div>

        <h3>üéØ –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:</h3>
        <div class="status success">
            ‚úÖ <strong>–†–µ–∞–ª—å–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã:</strong> 34.10384, -117.801<br>
            ‚úÖ <strong>–í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ—Ç—á–µ—Ç–∞:</strong> 2025-09-28T18:36:39<br>
            ‚úÖ <strong>–ò—Å—Ç–æ—á–Ω–∏–∫ –ø–æ–∑–∏—Ü–∏–∏:</strong> GPS<br>
            ‚úÖ <strong>–£—Ä–æ–≤–µ–Ω—å –∑–∞—Ä—è–¥–∞:</strong> 100% (4200mV)<br>
            ‚úÖ <strong>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:</strong> Freightliner_M2_106 (KeyCode: XHR-989)
        </div>
    </div>

    <script>
        let logs = [];

        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            logs.push(logEntry);
            
            const logsElement = document.getElementById('logs');
            logsElement.textContent = logs.join('\n');
            logsElement.scrollTop = logsElement.scrollHeight;
            
            console.log(logEntry);
        }

        function clearLogs() {
            logs = [];
            document.getElementById('logs').textContent = '–õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã...\n';
        }

        async function testRealGPSData() {
            addLog('üì° –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö GPS –¥–∞–Ω–Ω—ã—Ö...');
            
            try {
                const response = await fetch('http://localhost:3003/api/trak4/device', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        APIKey: 'Xx7MWwsU1234567890abcdef1234567890',
                        DeviceID: 153332
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    addLog('‚úÖ GPS –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!', 'success');
                    displayGPSData(data);
                } else {
                    addLog(`‚ùå –û—à–∏–±–∫–∞ GPS API: ${data.error}`, 'error');
                    addLog(`üìä –°—Ç–∞—Ç—É—Å: ${response.status} ${response.statusText}`, 'error');
                }
            } catch (error) {
                addLog(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`, 'error');
            }
        }

        function displayGPSData(data) {
            const container = document.getElementById('gps-data-container');
            
            if (data.Device) {
                const device = data.Device;
                const position = {
                    lat: device.LastReport_Latitude,
                    lng: device.LastReport_Longitude
                };
                
                container.innerHTML = `
                    <div class="gps-data">
                        <h4>üìç –¢–µ–∫—É—â–µ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</h4>
                        <div class="coordinate">–®–∏—Ä–æ—Ç–∞: ${position.lat}</div>
                        <div class="coordinate">–î–æ–ª–≥–æ—Ç–∞: ${position.lng}</div>
                        <div class="coordinate">–ò—Å—Ç–æ—á–Ω–∏–∫: ${device.LastReport_PositionSource}</div>
                        <div class="coordinate">–í—Ä–µ–º—è: ${new Date(device.LastReport_CreateTime).toLocaleString()}</div>
                    </div>
                    
                    <div class="device-info">
                        <h4>üöõ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</h4>
                        <div class="field">
                            <label>–£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ:</label>
                            <value>${device.Label} (${device.KeyCode})</value>
                        </div>
                        <div class="field">
                            <label>Device ID:</label>
                            <value>${device.DeviceID}</value>
                        </div>
                        <div class="field">
                            <label>IMEI:</label>
                            <value>${device.IMEI}</value>
                        </div>
                        <div class="field">
                            <label>–ü–æ–∫–æ–ª–µ–Ω–∏–µ:</label>
                            <value>${device.Generation}</value>
                        </div>
                        <div class="field">
                            <label>–ü—Ä–æ—à–∏–≤–∫–∞:</label>
                            <value>${device.Firmware}</value>
                        </div>
                        <div class="field">
                            <label>–ü—Ä–æ–¥—É–∫—Ç:</label>
                            <value>${device.ProductName}</value>
                        </div>
                    </div>
                    
                    <div class="device-info">
                        <h4>üîã –°—Ç–∞—Ç—É—Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</h4>
                        <div class="field">
                            <label>–£—Ä–æ–≤–µ–Ω—å –∑–∞—Ä—è–¥–∞:</label>
                            <value>${device.LastReport_VoltagePercent}% (${device.LastReport_Voltage}mV)</value>
                        </div>
                        <div class="field">
                            <label>–ß–∞—Å—Ç–æ—Ç–∞ –æ—Ç—á–µ—Ç–æ–≤:</label>
                            <value>${device.ReportingFrequency_Current}</value>
                        </div>
                        <div class="field">
                            <label>–ü–æ—Å–ª–µ–¥–Ω–∏–π –æ—Ç—á–µ—Ç:</label>
                            <value>${new Date(device.LastReport_ReceivedTime).toLocaleString()}</value>
                        </div>
                    </div>
                `;
                
                addLog(`üìç –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ${position.lat}, ${position.lng}`, 'success');
                addLog(`üöõ –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç: ${device.Label} (${device.KeyCode})`, 'success');
                addLog(`üîã –ó–∞—Ä—è–¥: ${device.LastReport_VoltagePercent}%`, 'success');
                addLog(`‚è∞ –í—Ä–µ–º—è: ${new Date(device.LastReport_CreateTime).toLocaleString()}`, 'success');
            } else {
                container.innerHTML = '<div class="status error">‚ùå –î–∞–Ω–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
            }
        }

        async function testMultipleDevices() {
            addLog('üöõ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤...');
            
            const devices = [
                { name: 'Freightliner M2', apiKey: 'Xx7MWwsU1234567890abcdef1234567890', deviceId: 153332 },
                { name: 'Test Vehicle 2', apiKey: 'Yy8NXxtV234567890bcdefg2345678901', deviceId: 153333 }
            ];
            
            for (let i = 0; i < devices.length; i++) {
                const device = devices[i];
                addLog(`üß™ –¢–µ—Å—Ç ${i + 1}/${devices.length}: ${device.name}`);
                
                try {
                    const response = await fetch('http://localhost:3003/api/trak4/device', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            APIKey: device.apiKey,
                            DeviceID: device.deviceId
                        })
                    });

                    const data = await response.json();

                    if (response.ok && data.Device) {
                        const pos = data.Device;
                        addLog(`‚úÖ ${device.name}: ${pos.LastReport_Latitude}, ${pos.LastReport_Longitude}`, 'success');
                    } else {
                        addLog(`‚ùå ${device.name}: ${data.error || 'Unknown error'}`, 'error');
                    }
                } catch (error) {
                    addLog(`‚ùå ${device.name}: ${error.message}`, 'error');
                }
                
                // –ü–∞—É–∑–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
            
            addLog('‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–æ');
        }

        function simulateVehicleMovement() {
            addLog('üéØ –°–∏–º—É–ª—è—Ü–∏—è –¥–≤–∏–∂–µ–Ω–∏—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞...');
            
            // –°–∏–º—É–ª—è—Ü–∏—è –¥–≤–∏–∂–µ–Ω–∏—è –ø–æ –º–∞—Ä—à—Ä—É—Ç—É
            const route = [
                { lat: 34.10384, lng: -117.801, name: '–°–∫–ª–∞–¥ A' },
                { lat: 34.12000, lng: -117.80000, name: '–¢–æ—á–∫–∞ 1' },
                { lat: 34.14000, lng: -117.79000, name: '–¢–æ—á–∫–∞ 2' },
                { lat: 34.16000, lng: -117.78000, name: '–°–∫–ª–∞–¥ B' }
            ];
            
            let currentIndex = 0;
            
            const moveInterval = setInterval(() => {
                if (currentIndex < route.length) {
                    const point = route[currentIndex];
                    addLog(`üöõ –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç –≤ —Ç–æ—á–∫–µ: ${point.name} (${point.lat}, ${point.lng})`);
                    currentIndex++;
                } else {
                    addLog('üèÅ –ú–∞—Ä—à—Ä—É—Ç –∑–∞–≤–µ—Ä—à–µ–Ω');
                    clearInterval(moveInterval);
                }
            }, 2000);
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            addLog('üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ GPS –¥–∞–Ω–Ω—ã–º–∏...');
            addLog('üí° –ù–∞–∂–º–∏—Ç–µ "üì° –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ GPS –¥–∞–Ω–Ω—ã–µ" –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏');
        };
    </script>
</body>
</html>
