<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–æ–ª–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        .button { padding: 10px 20px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .btn-danger { background: #dc3545; color: white; }
        .output { background: #f8f9fa; border: 1px solid #dee2e6; padding: 15px; margin: 10px 0; border-radius: 4px; white-space: pre-wrap; font-family: monospace; max-height: 400px; overflow-y: auto; }
        .status { padding: 10px; margin: 10px 0; border-radius: 4px; }
        .status.error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .status.success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; margin: 20px 0; }
        .card { background: #f8f9fa; border: 1px solid #dee2e6; padding: 15px; border-radius: 4px; }
        .card h4 { margin: 0 0 10px 0; color: #333; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß –ü–æ–ª–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è</h1>
        
        <div class="status error">
            <strong>‚ùå –ü—Ä–æ–±–ª–µ–º–∞:</strong> –ü—Ä–æ–≥—Ä–∞–º–º–∞ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∏ –≤–æ–¥–∏—Ç–µ–ª–µ–π, –Ω–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç, –Ω–∏ –º–∞—Ä—à—Ä—É—Ç –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
        </div>

        <h3>üîç –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:</h3>
        <button class="button btn-primary" onclick="fullDiagnosis()">üîç –ü–æ–ª–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö</button>
        <button class="button btn-warning" onclick="createTestData()">üß™ –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ</button>
        <button class="button btn-success" onclick="fixAllData()">üöÄ –ò—Å–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
        <button class="button btn-danger" onclick="resetAllData()">üóëÔ∏è –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>

        <div id="output" class="output">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏...</div>

        <div class="grid">
            <div class="card">
                <h4>üì¶ –ú–∞—Ä—à—Ä—É—Ç—ã</h4>
                <div id="routes-list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
            <div class="card">
                <h4>üë• –í–æ–¥–∏—Ç–µ–ª–∏</h4>
                <div id="drivers-list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
            <div class="card">
                <h4>üöö –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</h4>
                <div id="vehicles-list">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
            </div>
        </div>

        <h3>üéØ –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:</h3>
        <button class="button btn-success" onclick="quickCreateCompleteSetup()">‚ö° –°–æ–∑–¥–∞—Ç—å –ø–æ–ª–Ω—É—é —Ä–∞–±–æ—á—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é</button>
    </div>

    <script>
        function log(message) {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            output.textContent += `[${timestamp}] ${message}\n`;
            output.scrollTop = output.scrollHeight;
        }

        function updateDataDisplay() {
            try {
                // Routes
                const routes = JSON.parse(localStorage.getItem('routes') || '[]');
                const routesDiv = document.getElementById('routes-list');
                if (routes.length === 0) {
                    routesDiv.innerHTML = '<div style="color: red;">‚ùå –ù–ï–¢ –ú–ê–†–®–†–£–¢–û–í</div>';
                } else {
                    routesDiv.innerHTML = routes.map(route => 
                        `<div style="margin: 5px 0; padding: 5px; background: white; border-radius: 3px; border-left: 3px solid ${route.isActive ? 'green' : 'red'};">
                            üì¶ ${route.name}<br>
                            <small>–ê–∫—Ç–∏–≤–µ–Ω: ${route.isActive ? '–î–∞' : '–ù–µ—Ç'}</small><br>
                            <small>–í–æ–¥–∏—Ç–µ–ª—å: ${route.driverId || '–ù–ï –ù–ê–ó–ù–ê–ß–ï–ù'}</small><br>
                            <small>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç: ${route.vehicleId || '–ù–ï –ù–ê–ó–ù–ê–ß–ï–ù'}</small>
                        </div>`
                    ).join('');
                }

                // Drivers
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const drivers = users.filter(user => user.role === 'driver');
                const driversDiv = document.getElementById('drivers-list');
                if (drivers.length === 0) {
                    driversDiv.innerHTML = '<div style="color: red;">‚ùå –ù–ï–¢ –í–û–î–ò–¢–ï–õ–ï–ô</div>';
                } else {
                    driversDiv.innerHTML = drivers.map(driver => 
                        `<div style="margin: 5px 0; padding: 5px; background: white; border-radius: 3px;">
                            üë§ ${driver.firstName} ${driver.lastName}<br>
                            <small>ID: ${driver.id}</small>
                        </div>`
                    ).join('');
                }

                // Vehicles
                const vehicles = JSON.parse(localStorage.getItem('vehicles') || '[]');
                const vehiclesDiv = document.getElementById('vehicles-list');
                if (vehicles.length === 0) {
                    vehiclesDiv.innerHTML = '<div style="color: red;">‚ùå –ù–ï–¢ –¢–†–ê–ù–°–ü–û–†–¢–ê</div>';
                } else {
                    vehiclesDiv.innerHTML = vehicles.map(vehicle => 
                        `<div style="margin: 5px 0; padding: 5px; background: white; border-radius: 3px;">
                            üöö ${vehicle.name}<br>
                            <small>ID: ${vehicle.id}</small><br>
                            <small>–í–æ–¥–∏—Ç–µ–ª—å: ${vehicle.assignedDriver || '–ù–ï –ù–ê–ó–ù–ê–ß–ï–ù'}</small>
                        </div>`
                    ).join('');
                }
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è: ${error.message}`);
            }
        }

        function fullDiagnosis() {
            log('üîç ===== –ü–û–õ–ù–ê–Ø –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê –î–ê–ù–ù–´–• =====');
            
            try {
                const routes = JSON.parse(localStorage.getItem('routes') || '[]');
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const vehicles = JSON.parse(localStorage.getItem('vehicles') || '[]');
                const warehouses = JSON.parse(localStorage.getItem('warehouses') || '[]');
                
                log(`üìä –û–ë–©–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê:`);
                log(`   üì¶ –ú–∞—Ä—à—Ä—É—Ç–æ–≤: ${routes.length}`);
                log(`   üë• –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: ${users.length}`);
                log(`   üöö –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞: ${vehicles.length}`);
                log(`   üè≠ –°–∫–ª–∞–¥–æ–≤: ${warehouses.length}`);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–¥–∏—Ç–µ–ª–µ–π
                const drivers = users.filter(user => user.role === 'driver');
                log(`\nüë• –í–û–î–ò–¢–ï–õ–ò (${drivers.length}):`);
                if (drivers.length === 0) {
                    log('   ‚ùå –ù–ï–¢ –í–û–î–ò–¢–ï–õ–ï–ô! –°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–æ–ª—å—é "driver"');
                } else {
                    drivers.forEach(driver => {
                        log(`   ‚úÖ ${driver.firstName} ${driver.lastName} (ID: ${driver.id})`);
                    });
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã
                const activeRoutes = routes.filter(route => route.isActive);
                log(`\nüì¶ –ê–ö–¢–ò–í–ù–´–ï –ú–ê–†–®–†–£–¢–´ (${activeRoutes.length}):`);
                if (activeRoutes.length === 0) {
                    log('   ‚ùå –ù–ï–¢ –ê–ö–¢–ò–í–ù–´–• –ú–ê–†–®–†–£–¢–û–í! –°–æ–∑–¥–∞–π—Ç–µ –º–∞—Ä—à—Ä—É—Ç—ã –≤ Route Management');
                } else {
                    activeRoutes.forEach(route => {
                        const driver = users.find(u => u.id === route.driverId);
                        const vehicle = vehicles.find(v => v.id === route.vehicleId);
                        
                        log(`   üì¶ ${route.name}:`);
                        log(`      –í–æ–¥–∏—Ç–µ–ª—å: ${driver ? `${driver.firstName} ${driver.lastName}` : '‚ùå –ù–ï –ù–ê–ô–î–ï–ù'} (ID: ${route.driverId || '–ù–ï–¢'})`);
                        log(`      –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç: ${vehicle ? vehicle.name : '‚ùå –ù–ï –ù–ê–ô–î–ï–ù'} (ID: ${route.vehicleId || '–ù–ï–¢'})`);
                        log(`      –°–∫–ª–∞–¥–æ–≤: ${route.stops?.length || 0}`);
                    });
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
                log(`\nüöö –¢–†–ê–ù–°–ü–û–†–¢ (${vehicles.length}):`);
                if (vehicles.length === 0) {
                    log('   ‚ùå –ù–ï–¢ –¢–†–ê–ù–°–ü–û–†–¢–ê! –°–æ–∑–¥–∞–π—Ç–µ –∞–≤—Ç–æ–º–æ–±–∏–ª–∏ –≤ Fleet Management');
                } else {
                    vehicles.forEach(vehicle => {
                        log(`   üöö ${vehicle.name} (ID: ${vehicle.id}) ‚Üí ${vehicle.assignedDriver || '–ù–ï –ù–ê–ó–ù–ê–ß–ï–ù'}`);
                    });
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—é
                log(`\nüéØ –ì–û–¢–û–í–ù–û–°–¢–¨ –ö –û–¢–°–õ–ï–ñ–ò–í–ê–ù–ò–Æ:`);
                let readyRoutes = 0;
                
                activeRoutes.forEach(route => {
                    const driver = users.find(u => u.id === route.driverId);
                    const vehicle = vehicles.find(v => v.id === route.vehicleId);
                    
                    if (driver && vehicle && route.stops?.length > 0) {
                        readyRoutes++;
                        log(`   ‚úÖ ${route.name} –≥–æ—Ç–æ–≤ –∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—é`);
                    } else {
                        log(`   ‚ùå ${route.name} –ù–ï –≥–æ—Ç–æ–≤:`);
                        if (!driver) log(`      ‚Ä¢ –ù–µ—Ç –≤–æ–¥–∏—Ç–µ–ª—è`);
                        if (!vehicle) log(`      ‚Ä¢ –ù–µ—Ç —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞`);
                        if (!route.stops?.length) log(`      ‚Ä¢ –ù–µ—Ç –æ—Å—Ç–∞–Ω–æ–≤–æ–∫`);
                    }
                });
                
                log(`\nüìä –ò–¢–û–ì: ${readyRoutes} –∏–∑ ${activeRoutes.length} –º–∞—Ä—à—Ä—É—Ç–æ–≤ –≥–æ—Ç–æ–≤—ã –∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—é`);
                
                if (readyRoutes === 0) {
                    log('\n‚ùå –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê: –ù–ò –û–î–ò–ù –ú–ê–†–®–†–£–¢ –ù–ï –ì–û–¢–û–í –ö –û–¢–°–õ–ï–ñ–ò–í–ê–ù–ò–Æ!');
                    log('   –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ "‚ö° –°–æ–∑–¥–∞—Ç—å –ø–æ–ª–Ω—É—é —Ä–∞–±–æ—á—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é" –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è');
                }
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏: ${error.message}`);
            }
        }

        function createTestData() {
            log('üß™ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö...');
            
            try {
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã—Ö –≤–æ–¥–∏—Ç–µ–ª–µ–π
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const existingDrivers = users.filter(u => u.role === 'driver');
                
                if (existingDrivers.length === 0) {
                    const testDrivers = [
                        {
                            id: `driver_${Date.now()}_1`,
                            firstName: '–ò–≤–∞–Ω',
                            lastName: '–ü–µ—Ç—Ä–æ–≤',
                            login: 'ivan.petrov',
                            role: 'driver',
                            email: 'ivan@example.com',
                            createdAt: new Date().toISOString()
                        },
                        {
                            id: `driver_${Date.now()}_2`,
                            firstName: '–ü–µ—Ç—Ä',
                            lastName: '–°–∏–¥–æ—Ä–æ–≤',
                            login: 'petr.sidorov',
                            role: 'driver',
                            email: 'petr@example.com',
                            createdAt: new Date().toISOString()
                        }
                    ];
                    
                    users.push(...testDrivers);
                    localStorage.setItem('users', JSON.stringify(users));
                    log(`‚úÖ –°–æ–∑–¥–∞–Ω–æ ${testDrivers.length} —Ç–µ—Å—Ç–æ–≤—ã—Ö –≤–æ–¥–∏—Ç–µ–ª–µ–π`);
                } else {
                    log(`‚ÑπÔ∏è –í–æ–¥–∏—Ç–µ–ª–∏ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç: ${existingDrivers.length}`);
                }
                
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç
                const vehicles = JSON.parse(localStorage.getItem('vehicles') || '[]');
                
                if (vehicles.length === 0) {
                    const testVehicles = [
                        {
                            id: `vehicle_${Date.now()}_1`,
                            name: '–ì—Ä—É–∑–æ–≤–∏–∫ 001',
                            licensePlate: '–ê123–ë–í',
                            assignedDriver: '–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤',
                            gpsApiKey: 'test-api-key',
                            trak4DeviceId: 153332,
                            speedLimit: 55,
                            createdAt: new Date().toISOString()
                        },
                        {
                            id: `vehicle_${Date.now()}_2`,
                            name: '–ì—Ä—É–∑–æ–≤–∏–∫ 002',
                            licensePlate: '–ë456–ì–î',
                            assignedDriver: '–ü–µ—Ç—Ä –°–∏–¥–æ—Ä–æ–≤',
                            gpsApiKey: 'test-api-key',
                            trak4DeviceId: 153333,
                            speedLimit: 55,
                            createdAt: new Date().toISOString()
                        }
                    ];
                    
                    localStorage.setItem('vehicles', JSON.stringify(testVehicles));
                    log(`‚úÖ –°–æ–∑–¥–∞–Ω–æ ${testVehicles.length} —Ç–µ—Å—Ç–æ–≤—ã—Ö –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–π`);
                } else {
                    log(`‚ÑπÔ∏è –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç: ${vehicles.length}`);
                }
                
                // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ —Å–∫–ª–∞–¥—ã
                const warehouses = JSON.parse(localStorage.getItem('warehouses') || '[]');
                
                if (warehouses.length === 0) {
                    const testWarehouses = [
                        {
                            id: `warehouse_${Date.now()}_1`,
                            name: '–°–∫–ª–∞–¥ –ê',
                            fullAddress: '123 Main St, Los Angeles, CA',
                            coordinates: { lat: 34.0522, lng: -118.2437 },
                            iconColor: '#FF6B6B',
                            unit: 'A-1',
                            createdAt: new Date().toISOString()
                        },
                        {
                            id: `warehouse_${Date.now()}_2`,
                            name: '–°–∫–ª–∞–¥ –ë',
                            fullAddress: '456 Oak Ave, Los Angeles, CA',
                            coordinates: { lat: 34.0622, lng: -118.2537 },
                            iconColor: '#4ECDC4',
                            unit: 'B-2',
                            createdAt: new Date().toISOString()
                        },
                        {
                            id: `warehouse_${Date.now()}_3`,
                            name: '–°–∫–ª–∞–¥ –í',
                            fullAddress: '789 Pine St, Los Angeles, CA',
                            coordinates: { lat: 34.0722, lng: -118.2637 },
                            iconColor: '#45B7D1',
                            unit: 'C-3',
                            createdAt: new Date().toISOString()
                        }
                    ];
                    
                    localStorage.setItem('warehouses', JSON.stringify(testWarehouses));
                    log(`‚úÖ –°–æ–∑–¥–∞–Ω–æ ${testWarehouses.length} —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–∫–ª–∞–¥–æ–≤`);
                } else {
                    log(`‚ÑπÔ∏è –°–∫–ª–∞–¥—ã —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç: ${warehouses.length}`);
                }
                
                updateDataDisplay();
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö: ${error.message}`);
            }
        }

        function fixAllData() {
            log('üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö...');
            
            try {
                const routes = JSON.parse(localStorage.getItem('routes') || '[]');
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const vehicles = JSON.parse(localStorage.getItem('vehicles') || '[]');
                
                const drivers = users.filter(u => u.role === 'driver');
                
                // –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –≤ –º–∞—Ä—à—Ä—É—Ç–∞—Ö
                let fixedRoutes = 0;
                
                routes.forEach(route => {
                    let routeFixed = false;
                    
                    // –ù–∞–∑–Ω–∞—á–∞–µ–º –≤–æ–¥–∏—Ç–µ–ª—è –µ—Å–ª–∏ –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω
                    if (!route.driverId && drivers.length > 0) {
                        const availableDriver = drivers.find(d => 
                            !routes.some(r => r.driverId === d.id)
                        ) || drivers[0];
                        
                        route.driverId = availableDriver.id;
                        routeFixed = true;
                        log(`‚úÖ –ù–∞–∑–Ω–∞—á–µ–Ω –≤–æ–¥–∏—Ç–µ–ª—å –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∞ ${route.name}: ${availableDriver.firstName} ${availableDriver.lastName}`);
                    }
                    
                    // –ù–∞–∑–Ω–∞—á–∞–µ–º —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –µ—Å–ª–∏ –Ω–µ –Ω–∞–∑–Ω–∞—á–µ–Ω
                    if (!route.vehicleId && vehicles.length > 0) {
                        const availableVehicle = vehicles.find(v => 
                            !routes.some(r => r.vehicleId === v.id)
                        ) || vehicles[0];
                        
                        route.vehicleId = availableVehicle.id;
                        routeFixed = true;
                        log(`‚úÖ –ù–∞–∑–Ω–∞—á–µ–Ω —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç –¥–ª—è –º–∞—Ä—à—Ä—É—Ç–∞ ${route.name}: ${availableVehicle.name}`);
                    }
                    
                    // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –º–∞—Ä—à—Ä—É—Ç
                    if (!route.isActive) {
                        route.isActive = true;
                        routeFixed = true;
                        log(`‚úÖ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω –º–∞—Ä—à—Ä—É—Ç: ${route.name}`);
                    }
                    
                    if (routeFixed) {
                        fixedRoutes++;
                    }
                });
                
                // –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –≤ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–µ
                let fixedVehicles = 0;
                
                vehicles.forEach(vehicle => {
                    if (!vehicle.assignedDriver && drivers.length > 0) {
                        const availableDriver = drivers.find(d => 
                            !vehicles.some(v => v.assignedDriver === `${d.firstName} ${d.lastName}`)
                        ) || drivers[0];
                        
                        vehicle.assignedDriver = `${availableDriver.firstName} ${availableDriver.lastName}`;
                        fixedVehicles++;
                        log(`‚úÖ –ù–∞–∑–Ω–∞—á–µ–Ω –≤–æ–¥–∏—Ç–µ–ª—å –¥–ª—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ ${vehicle.name}: ${vehicle.assignedDriver}`);
                    }
                });
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                localStorage.setItem('routes', JSON.stringify(routes));
                localStorage.setItem('vehicles', JSON.stringify(vehicles));
                
                log(`\nüéâ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø –ó–ê–í–ï–†–®–ï–ù–´:`);
                log(`   üì¶ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –º–∞—Ä—à—Ä—É—Ç–æ–≤: ${fixedRoutes}`);
                log(`   üöö –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞: ${fixedVehicles}`);
                
                updateDataDisplay();
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö: ${error.message}`);
            }
        }

        function quickCreateCompleteSetup() {
            log('‚ö° –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–π —Ä–∞–±–æ—á–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏...');
            
            // –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–µ–º –±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
            createTestData();
            
            setTimeout(() => {
                // –ó–∞—Ç–µ–º –∏—Å–ø—Ä–∞–≤–ª—è–µ–º —Å–≤—è–∑–∏
                fixAllData();
                
                setTimeout(() => {
                    // –°–æ–∑–¥–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã
                    createTestRoutes();
                    
                    setTimeout(() => {
                        log('\n‚úÖ –ü–û–õ–ù–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –°–û–ó–î–ê–ù–ê!');
                        log('üéØ –¢–µ–ø–µ—Ä—å –≤–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ Dashboard ‚Üí –ú–∞—Ä—à—Ä—É—Ç—ã –∏ –Ω–∞–∂–º–∏—Ç–µ "–ù–∞—á–∞—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ"');
                        updateDataDisplay();
                    }, 1000);
                }, 1000);
            }, 1000);
        }

        function createTestRoutes() {
            log('üì¶ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤...');
            
            try {
                const routes = JSON.parse(localStorage.getItem('routes') || '[]');
                const users = JSON.parse(localStorage.getItem('users') || '[]');
                const vehicles = JSON.parse(localStorage.getItem('vehicles') || '[]');
                const warehouses = JSON.parse(localStorage.getItem('warehouses') || '[]');
                
                const drivers = users.filter(u => u.role === 'driver');
                
                if (routes.length === 0 && drivers.length > 0 && vehicles.length > 0 && warehouses.length > 0) {
                    const testRoutes = [
                        {
                            id: `route_${Date.now()}_1`,
                            name: '–£—Ç—Ä–µ–Ω–Ω–∏–π –º–∞—Ä—à—Ä—É—Ç',
                            driverId: drivers[0].id,
                            vehicleId: vehicles[0].id,
                            isActive: true,
                            stops: [
                                {
                                    id: `stop_${Date.now()}_1`,
                                    warehouseId: warehouses[0].id,
                                    arrivalTime: '08:00',
                                    departureTime: '08:30',
                                    order: 1
                                },
                                {
                                    id: `stop_${Date.now()}_2`,
                                    warehouseId: warehouses[1].id,
                                    arrivalTime: '09:00',
                                    departureTime: '09:30',
                                    order: 2
                                },
                                {
                                    id: `stop_${Date.now()}_3`,
                                    warehouseId: warehouses[2].id,
                                    arrivalTime: '10:00',
                                    departureTime: '10:30',
                                    order: 3
                                }
                            ],
                            createdAt: new Date(),
                            updatedAt: new Date()
                        }
                    ];
                    
                    if (drivers.length > 1 && vehicles.length > 1) {
                        testRoutes.push({
                            id: `route_${Date.now()}_2`,
                            name: '–î–Ω–µ–≤–Ω–æ–π –º–∞—Ä—à—Ä—É—Ç',
                            driverId: drivers[1].id,
                            vehicleId: vehicles[1].id,
                            isActive: true,
                            stops: [
                                {
                                    id: `stop_${Date.now()}_4`,
                                    warehouseId: warehouses[2].id,
                                    arrivalTime: '14:00',
                                    departureTime: '14:30',
                                    order: 1
                                },
                                {
                                    id: `stop_${Date.now()}_5`,
                                    warehouseId: warehouses[0].id,
                                    arrivalTime: '15:00',
                                    departureTime: '15:30',
                                    order: 2
                                }
                            ],
                            createdAt: new Date(),
                            updatedAt: new Date()
                        });
                    }
                    
                    localStorage.setItem('routes', JSON.stringify(testRoutes));
                    log(`‚úÖ –°–æ–∑–¥–∞–Ω–æ ${testRoutes.length} —Ç–µ—Å—Ç–æ–≤—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤ —Å –ø–æ–ª–Ω—ã–º–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è–º–∏`);
                } else {
                    log(`‚ÑπÔ∏è –ú–∞—Ä—à—Ä—É—Ç—ã —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏–ª–∏ –Ω–µ—Ç –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö`);
                }
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤: ${error.message}`);
            }
        }

        function resetAllData() {
            log('üóëÔ∏è –°–±—Ä–æ—Å –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö...');
            
            if (confirm('‚ö†Ô∏è –≠—Ç–æ —É–¥–∞–ª–∏—Ç –í–°–ï –¥–∞–Ω–Ω—ã–µ! –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
                localStorage.removeItem('routes');
                localStorage.removeItem('users');
                localStorage.removeItem('vehicles');
                localStorage.removeItem('warehouses');
                localStorage.removeItem('gps_tracking_logs');
                
                // –£–¥–∞–ª—è–µ–º –≤—Å–µ –ø—Ä–æ–≥—Ä–µ—Å—Å—ã –º–∞—Ä—à—Ä—É—Ç–æ–≤
                for (let i = localStorage.length - 1; i >= 0; i--) {
                    const key = localStorage.key(i);
                    if (key && key.startsWith('actual_route_')) {
                        localStorage.removeItem(key);
                    }
                }
                
                log('‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã');
                updateDataDisplay();
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏
        window.onload = function() {
            log('üîç –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ...');
            updateDataDisplay();
            fullDiagnosis();
        };
    </script>
</body>
</html>
